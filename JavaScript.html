<script>
// need to use window object as per Google documentation to prevent recompilation.
window.inputId = ["firstName", "lastName", "birthday", "birthdayPresent"];

window.addValues = function(e) {
  var arrayValues = [];
  
  $(this).attr("disabled", true); // cant use CSS selectors for [disabled] due to Caja? need alt way to show it is disabled.
  $("#submit-wrapper").append('<div id="submit-button-overlay"></div>');
  console.log("Submit button clicked");
  
  // get value of each form input element
  inputId.forEach(function(el) {
    arrayValues.push($("#"+el).val());
  });
  
  console.log(arrayValues);
  
  google.script.run.withSuccessHandler(onSuccessSubmit)
    .gsProcessInput(arrayValues); //async
};

// clear input fields, append status message, then upon timeout: fade & remove submit button overlay and also the status message.
window.onSuccessSubmit = function() {
  var timeout;
  
  console.log("Values submitted succesfully");
  
  // clear the input
  inputId.forEach(function(el) {
    $("#"+el).val("");
  });
  
  // apply our overlay on the submit button (can't use CSS [disabled] attribute due to Google host)
  $("form").append('<div id="status-success">Data submitted to form succesfully</div>');
  
  // fade out the submit button overlay and status message together
  timeout = window.setTimeout(function() {
    fadeRemoveCb($("#status-success"));
    fadeRemoveCb($("#submit-button-overlay"), function() {
      //renable the submit button
      $("#submit-button").attr("disabled", false);
    });
  }, 2000);
};

window.fadeRemoveCb = function($removee, callback) {
  $removee.fadeOut(1000, function() {
    $removee.remove();
    if (callback) { callback() };
  });
};
</script>
